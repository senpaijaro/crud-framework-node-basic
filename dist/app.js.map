{"version":3,"sources":["../app/app.js"],"names":["app","static_dir","__dirname","node_plugins","replace","template","views","set","path","join","use","express","static","key","secret","resave","saveUninitialized","cookie","secure","maxAge","bodyParser","urlencoded","extended","limit","json","controllers","dir","match","recursive","map","name","isFile","requireAll","policies","_","each","routes","value","index","getApi","split","middleware","policy","val","ind","indexOf","change","push","console","log","toLowerCase","listen"],"mappings":"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","file":"app.js","sourcesContent":["'use strict'\r\nimport \"babel-polyfill\";\r\n//modules  \r\nimport express from 'express'\r\nimport requireAll from 'require.all'\r\nimport {compose} from 'compose-middleware'\r\nimport _ from 'underscore'\r\nimport validition from 'express-validator'\r\nimport cookieParser  from 'cookie-parser'\r\nimport bodyParser from 'body-parser'\r\nimport path from 'path'\r\nimport flash  from 'express-flash'\r\nimport session  from 'express-session'\r\n\r\nimport ejs from 'ejs'\r\n//files\r\nimport routes from './application/config/routes'\r\nimport policy from './application/config/policies'\r\n\r\n//constant variables\r\nconst app    = express(),\r\nstatic_dir   = __dirname+'/node_modules/',\r\nnode_plugins = static_dir.replace('dist/',''),\r\ntemplate = __dirname+'/template/',\r\nviews = template.replace('dist/','')\r\n\r\n//set or user function\r\napp.set('views',  path.join(views))\r\napp.set('view engine', 'ejs');\r\napp.use('/assets', express.static(node_plugins))\r\napp.use(validition())\r\napp.use(flash())\r\napp.use(cookieParser());\r\napp.set('trust proxy', 1) // trust first proxy\r\napp.use(session({\r\n    key: 'password!@#$',\r\n    secret: 'keyboard cat',\r\n    resave: false,\r\n    saveUninitialized: true,\r\n    cookie: { \r\n        secure: false, maxAge: 20000000 \r\n    }\r\n}));\r\n//body parser\r\napp.use(bodyParser.urlencoded({ extended: true,limit: '50mb' }));\r\napp.use(bodyParser.json({limit: '50mb'}));\r\n\r\nlet controllers = requireAll({\r\n\tdir: './application/controller', //only files that end with 'controller.js' \r\n\tmatch: /Controller\\.js$/i,\r\n\trecursive: false,\r\n\tmap: (name, path, isFile ) => requireAll.map(name, path, isFile).replace(/Controller$/i,'')\r\n}),\r\npolicies = requireAll({\r\n\tdir: './application/policies',\r\n  \tmatch: /Policy\\.js$/i, //only files that end with 'controller.js' \r\n})\r\n\r\n_.each(routes, function(value, index){\r\n\tlet getApi = index.split(\" \"),\r\n\tpath = value.split(\".\"),\r\n\tmiddleware = []\r\n\r\n\t_.each(policy[\"policies\"], function(val, ind){\r\n\t\tif(path[0] == ind && path[1] in val){\r\n\t\t\tmiddleware = val[path[1]];\r\n\t\t\treturn false;\r\n\t\t}\r\n\t});\r\n\r\n\t_.each(middleware, function(val, ind){\r\n\t\tif(val.indexOf(\"Policy\") > -1 ){\r\n\t\t\tmiddleware[ind] = policies[val];\r\n\t\t}\r\n\t});\r\n\tconst change = getApi[0]\r\n\tmiddleware.push(controllers[path[0]][path[1]])\r\n\tconsole.log(controllers[path[0]])\r\n\tconsole.log([path[1]])\r\n\tapp[change.toLowerCase()](getApi[1], compose(middleware))\r\n})\r\n\r\napp.listen(4200, function(){\r\n\tconsole.log('running port ' + 4200)\r\n}) \r\n\r\n"]}